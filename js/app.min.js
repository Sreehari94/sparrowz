angular.module("Sparrowz",["ngSanitize"]).controller("AppCtrl",["$scope","$http","$q",function(t,e,a){t.thData={},t.selectedChoice={value:""},t.message={data:""};var o=function(){var t=a.defer(),o={header:{clientId:"SPARROWZ_WEBSITE",apiVersion:apiVersion},body:{}};console.log("form data to get treasureHunts: ",o);var n={method:"POST",url:URL+"/services/guest/getCities",headers:{"Content-Type":"application/json"},data:o};return e(n).then(function(e){console.log("getCityList response: ",e),t.resolve(e.data.body)},function(a){console.log("Error: ",a),e.get("assets/city.json").then(function(e){console.log("getCityList response: ",e),t.resolve(e.data.body)},function(e){console.log("Error: ",e),t.reject("error")})}),t.promise},n=function(){var t=a.defer();return navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){t.resolve(e)},function(e){t.reject(e)}):t.reject("Geolocation not supported."),t.promise},r=function(e){var o=a.defer();return t.geolat=e.coords.latitude,t.geolng=e.coords.longitude,s(e).then(function(t){u(t).then(function(t){console.log("got user current city: ",t),o.resolve(t)},function(t){console.log("user current city couldn't extract from geocoder"),o.reject("error")})},function(t){console.log("error getting current position: ",t),o.reject("error")}),o.promise},s=function(){var e=a.defer();if(google){var o=new google.maps.Geocoder,n=new google.maps.LatLng(t.geolat,t.geolng);o.geocode({latLng:n},function(t,a){a==google.maps.GeocoderStatus.OK&&t[0]&&t[1]?(console.log("geocoder data: ",t[1]),e.resolve(t[1])):(console.log("address not found"),e.reject(t))})}else console.log("google not defined"),e.reject("google not defined");return e.promise},u=function(t){for(var e=a.defer(),o={long_name:null},n=0,r=0;r<t.address_components.length;r++)"locality"==t.address_components[r].types[0]&&(n=r,console.log("index found at: ",r));return o=t.address_components[n],console.log("cityName by new method: ",o.long_name),e.resolve(o.long_name),e.promise},l=function(){o().then(function(e){console.log("got response",e),t.cityData=e;var a=t.cityData.cityList.length;console.log("CityList length: ",a),n().then(function(e){console.log("got position",e),r(e).then(function(e){console.log("got cityname:",e);for(var a=null,o=0;o<t.cityData.cityList.length;o++)e==t.cityData.cityList[o].cityName&&(a=o);if(null!=a){var n=t.cityData.cityList[a];t.city_name=n.cityDisplayName,t.setCity(n.cityId).then(function(){g(n.cityId)},function(t){console.log("error")})}else c()},function(t){console.log(t)})},function(t){console.log(t),c()})},function(t){console.log(t)})};l();var c=function(){t.city_name="Bengaluru",console.log("CITY NAME: ",t.city_name),t.setCity(1).then(function(){g(1)},function(t){console.log("error")})};t.setErrorMessage=function(){t.message={data:"Weâ€™ll be back in a while..."}},t.setCity=function(o){var n=a.defer();return e.get("assets/mcq.json").then(function(e){t.mcqData=e.data.body,console.log("Response: ",e),console.log("MCQ Data: ",t.mcqData.mcq);for(var a=0;a<t.mcqData.mcq.length;a++)if(t.mcqData.mcq[a].cityId==o){var n=Math.floor(Math.random()*t.mcqData.mcq[a].mcqQuestions.length);t.question=t.mcqData.mcq[a].mcqQuestions[n].question,console.log(t.question),t.answer=t.mcqData.mcq[a].mcqQuestions[n].answer,console.log(t.answer),t.mcqOptions=t.mcqData.mcq[a].mcqQuestions[n].opts,console.log("MCQ options: ",t.mcqOptions),t.success=t.mcqData.mcq[a].mcqQuestions[n].successMessage,t.failure=t.mcqData.mcq[a].mcqQuestions[n].failureMessage}},function(t){console.log("Error: ",t)}),"11"==o?(console.log(o),document.body.style.backgroundImage="url('img/bg.jpg')"):(console.log(o),document.body.style.background="white"),n.resolve(),n.promise};var g=function(a){var o={header:{clientId:"SPARROWZ_WEBSITE",apiVersion:apiVersion},body:{cityId:a}};console.log("form data to get treasureHunts: ",o);var n={method:"POST",url:URL+"/services/guest/getTreasureHunts",headers:{"Content-Type":"application/json"},data:o};e(n).then(function(e){t.thData=e.data.body,console.log(e.data.body),console.log("TH Data: ",t.thData);for(var a=0;a<t.thData.treasureHunts.length;a++)t.addData(t.thData,a);m(t.thData)},function(o){console.log("Error: ",o),t.setErrorMessage(),e.get("assets/thlist_"+a+".json").then(function(e){t.thData=e.data.body,console.log(e.data.body),console.log("TH Data: ",t.thData);for(var a=0;a<t.thData.treasureHunts.length;a++)t.addData(t.thData,a);m(t.thData)},function(t){console.log("Error: ",t)})})};t.changeCity=function(e,a){t.city_name=a,t.setCity(e).then(function(){g(e)},function(t){console.log("error")})};var m=function(t){var e,a=function(t,a){var o=t[a].geoLocationDetails.marker;google.maps.event.addListener(o,"mouseover",function(){if(null==this.getAnimation()||"undefined"==typeof this.getAnimation()){clearTimeout(e);var t=this;e=setTimeout(function(){t.setAnimation(google.maps.Animation.BOUNCE)},500)}}),google.maps.event.addListener(o,"mouseout",function(){null!=this.getAnimation()&&this.setAnimation(null),clearTimeout(e)}),google.maps.event.addListener(o,"click",function(){console.log("Print",t[a]),i(),u(t[a]).open(mapObject,this),console.log(t[a]),mapObject.setCenter(new google.maps.LatLng(t[a].geoLocationDetails.latitude,t[a].geoLocationDetails.longitude))})};markersData=t.treasureHunts;var o=t.treasureHunts[0].geoLocationDetails.latitude,n=t.treasureHunts[0].geoLocationDetails.longitude;console.log("new: ",o,n),mapObject=new google.maps.Map(document.getElementById("map"),{zoom:13,center:new google.maps.LatLng(o,n),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.LEFT_CENTER},panControl:!1,panControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.RIGHT_BOTTOM},scrollwheel:!1,scaleControl:!1,scaleControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER},streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},styles:[{featureType:"landscape",stylers:[{hue:"#FFBB00"},{saturation:43.400000000000006},{lightness:37.599999999999994},{gamma:1}]},{featureType:"road.highway",stylers:[{hue:"#FFC200"},{saturation:-61.8},{lightness:45.599999999999994},{gamma:1}]},{featureType:"road.arterial",stylers:[{hue:"#FF0300"},{saturation:-100},{lightness:51.19999999999999},{gamma:1}]},{featureType:"road.local",stylers:[{hue:"#FF0300"},{saturation:-100},{lightness:52},{gamma:1}]},{featureType:"water",stylers:[{hue:"#0078FF"},{saturation:-13.200000000000003},{lightness:2.4000000000000057},{gamma:1}]},{featureType:"poi",stylers:[{hue:"#00FF6A"},{saturation:-1.0989010989011234},{lightness:11.200000000000017},{gamma:1}]}]}),console.log("current: ",o,n),console.log("markersData",markersData);for(var r=0;r<markersData.length;r++){var s=new google.maps.Marker({position:new google.maps.LatLng(markersData[r].geoLocationDetails.latitude,markersData[r].geoLocationDetails.longitude),map:mapObject,icon:"img/pins/"+markersData[r].kind+".png"});markersData[r].geoLocationDetails.marker=s,a(markersData,r)}var i=function(){$("div.infoBox").remove()},u=function(t){return ga("send",{hitType:"event",eventCategory:"THmarker",eventAction:"User clicked on "+t.treasureHuntName+" marker in map",eventLabel:"USER_CLICKED_ON_TH_MARKER",eventValue:0}),new InfoBox({closeBoxMargin:"2px -20px 2px 2px",closeBoxURL:"http://www.google.com/intl/en_us/mapfiles/close.gif",content:'<div class="marker_info_2"><img src="'+t.treasureHuntImgUrl[0]+'" width="240" height="80" class="img-responsive" alt="Image" onerror="this.src=\'img/no image.jpg\'" ><br/><h3 style="color:blue;">'+t.treasureHuntName+"</h3><span>"+t.treasureHuntDescription+"</span><br/></div>",disableAutoPan:!0,maxWidth:0,pixelOffset:new google.maps.Size(10,-200),isHidden:!1,pane:"floatPane",enableEventPropagation:!0})}};t.onHtmlClick=function(e){t.states={},ga("send",{hitType:"event",eventCategory:"ViewOnMap",eventAction:"User clicked on "+e.treasureHuntName+" view on map",eventLabel:"USER_CLICKED_ON_VIEW_ON_MAP",eventValue:0}),console.log("Hunt : ",e),google.maps.event.trigger(e.geoLocationDetails.marker,"click")},t.cardClick=function(e,a,o,n,r){ga("send",{hitType:"event",eventCategory:"THcard",eventAction:"User clicked on "+e+" card ",eventLabel:"USER_CLICKED_ON_TH_CARD",eventValue:0}),t.modalName=e,t.modalImage=a,t.modalDescription=o,t.approx_Time=n,t.qr_id=r};var h=function(t){var e=[];if(null!=t){var a=".";return t.indexOf(a)>=0?e=t.split(a):(e[0]=t,e)}},d=function(t){var e=[];if(null!=t){var a="/";return t.indexOf(a)>=0?e=t.split(a):(e[0]=t,e)}},p=function(t){var e=t[0]+"_web_small."+t[1];return e},D=function(t){var e=d(t),a=e.length,o=h(e[a-1]);e[a-1]=p(o);var n="";for(i=1;i<e.length;i++)n+="/",n+=e[i];return n=window.location.protocol+n,console.log("Path name: ",n),n};t.submitAnswer=function(){console.log("Result from select: ",t.selectedChoice.value),console.log("MCQ answer: ",t.answer),t.selectedChoice.value==t.answer?(t.submitImgUrl="img/correct.png",t.submitMessage="Congratulations. Your answer is correct.",t.cluedetail=t.success):(t.submitImgUrl="img/wrong.png",t.submitMessage="Sorry wrong answer. Better luck next time.",t.cluedetail=t.failure)},t.goToEventPage=function(t){ga("send",{hitType:"event",eventCategory:"BuyTickets",eventAction:"User clicked on "+t+" event buy tickets button",eventLabel:"USER_CLICKED_ON_BUY_TICKETS_BUTTON",eventValue:0})},t.addData=function(e,a){console.log("Values in addData: ",e,a);var o=null;o=t.thData.treasureHunts[a].treasureHuntTags[0]&&t.thData.treasureHunts[a].treasureHuntTags[0].tagName&&t.thData.treasureHunts[a].treasureHuntTags[0].tagName?t.thData.treasureHunts[a].treasureHuntTags[0].tagName:null,"undefined"!=typeof t.thData.treasureHunts[a].treasureHuntImgUrl?t.thData.treasureHunts[a].treasureHuntImgUrl[0]=D(t.thData.treasureHunts[a].treasureHuntImgUrl[0]):t.thData.treasureHunts[a].treasureHuntImgUrl=["img/no image.jpg"],o?(console.log("Tag name: ",o),"OldRio"==o?(t.thData.treasureHunts[a].rate="popular",t.thData.treasureHunts[a].kind="Museums",t.thData.treasureHunts[a].game_icon="icon-museum"):"RioMarathonRoute"==o?(t.thData.treasureHunts[a].rate="top_rated",t.thData.treasureHunts[a].kind="Sport",t.thData.treasureHunts[a].game_icon="icon-school"):"WeekendChallenge"==o?(t.thData.treasureHunts[a].rate="new",t.thData.treasureHunts[a].kind="Sport",t.thData.treasureHunts[a].game_icon="icon-person"):"RioCentro"==o?(t.thData.treasureHunts[a].rate="popular",t.thData.treasureHunts[a].kind="Walking",t.thData.treasureHunts[a].game_icon="icon-person"):"Kormangala"==o?(t.thData.treasureHunts[a].rate="popular",t.thData.treasureHunts[a].kind="Th",t.thData.treasureHunts[a].game_icon="icon-flag-checkered"):"AdarshVista"==o?(t.thData.treasureHunts[a].rate="new",t.thData.treasureHunts[a].kind="Museums",t.thData.treasureHunts[a].game_icon="icon-town-hall"):"BeachWalk"==o?(t.thData.treasureHunts[a].rate="top_rated",t.thData.treasureHunts[a].kind="Beach",t.thData.treasureHunts[a].game_icon="icon-waves"):"HeritageBengaluru"==o||"Dommaluru"==o?(t.thData.treasureHunts[a].rate="popular",t.thData.treasureHunts[a].kind="Th",t.thData.treasureHunts[a].game_icon="icon-flag"):"LalbaghChallenge"==o?(t.thData.treasureHunts[a].rate="top_rated",t.thData.treasureHunts[a].kind="Th",t.thData.treasureHunts[a].game_icon="icon-road"):"MGRoad"==o?(t.thData.treasureHunts[a].rate="top-rated",t.thData.treasureHunts[a].kind="Th",t.thData.treasureHunts[a].game_icon="icon-road"):"India"==o?(t.thData.treasureHunts[a].rate="popular",t.thData.treasureHunts[a].kind="Th",t.thData.treasureHunts[a].game_icon="icon-flag"):"Technology Tour"==o?(t.thData.treasureHunts[a].rate="popular",t.thData.treasureHunts[a].kind="Th",t.thData.treasureHunts[a].game_icon="icon-monitor-1"):"FortKochi"==o||"HighwayCafe"==o?(t.thData.treasureHunts[a].rate="top_rated",t.thData.treasureHunts[a].kind="Th",t.thData.treasureHunts[a].game_icon="icon-anchor-2"):"Delhi"==o?(t.thData.treasureHunts[a].rate="popular",t.thData.treasureHunts[a].kind="Th",t.thData.treasureHunts[a].game_icon="icon-flag"):"Mumbai"==o?(t.thData.treasureHunts[a].rate="popular",t.thData.treasureHunts[a].kind="Th",t.thData.treasureHunts[a].game_icon="icon-town-hall"):"Dubai"==o?(t.thData.treasureHunts[a].rate="popular",t.thData.treasureHunts[a].kind="Th",t.thData.treasureHunts[a].game_icon="icon-flag-checkered"):"IIMB"==o?(t.thData.treasureHunts[a].rate="top_rated",t.thData.treasureHunts[a].kind="Th",t.thData.treasureHunts[a].game_icon="icon-town-hall"):"ChristRedeemer"==o?(t.thData.treasureHunts[a].rate="popular",t.thData.treasureHunts[a].kind="Walking",t.thData.treasureHunts[a].game_icon="icon-person"):"MakeHeritageFun"==o?(t.thData.treasureHunts[a].rate="new",t.thData.treasureHunts[a].kind="Th",t.thData.treasureHunts[a].game_icon="icon-flag-checkered"):(t.thData.treasureHunts[a].rate="new",t.thData.treasureHunts[a].kind="Th",t.thData.treasureHunts[a].game_icon="icon-flag")):(console.log("No tags found"),t.thData.treasureHunts[a].rate="new",t.thData.treasureHunts[a].kind="Th",t.thData.treasureHunts[a].game_icon="icon-flag"),60==t.thData.treasureHunts[a].treasureHuntId?t.thData.treasureHunts[a].eventUrl="https://www.eventshigh.com/detail/Bangalore/390e015da07eda8f2c445c41e1662ff8-sparrowz-lalbagh-adventure":53==t.thData.treasureHunts[a].treasureHuntId?t.thData.treasureHunts[a].eventUrl="https://www.eventshigh.com/detail/Bangalore/6e1f35dc36e71fcce9c61f8c9e0b7973-sparrowz-cubbon-treasure-hunt":t.thData.treasureHunts[a].eventUrl=null}}]);